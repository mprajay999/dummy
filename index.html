
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PJ's BBQ Restaurant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        body { background-color: #f5f5f5; color: #333; }
        header { background-color: white; border-bottom: 1px solid #e5e5e5; padding: 1rem; }
        nav { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; height: 4rem; }
        .logo { color: #c2410c; font-size: 1.5rem; font-weight: bold; text-decoration: none; }
        .nav-links { display: flex; gap: 1rem; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.375rem; border: none; cursor: pointer; font-weight: 500; }
        .btn-primary { background-color: #c2410c; color: white; }
        .btn-primary:hover { background-color: #9a3412; }
        .btn-ghost { background-color: transparent; color: #666; }
        .btn-ghost:hover { background-color: #f3f4f6; }
        .hero { height: 80vh; display: flex; align-items: center; justify-content: center; text-align: center; background-image: url(''); background-size: cover; position: relative; }
        .hero h1 { font-size: 3.75rem; margin-bottom: 1.5rem; }
        .hero p { font-size: 1.25rem; margin-bottom: 2rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 4rem 1rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; }
        .card { background-color: white; border-radius: 0.5rem; overflow: hidden; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); }
        .card-content { padding: 1.5rem; }
        .reviews { background-color: #f3f4f6; padding: 4rem 0; }
        #chat-widget { position: fixed; bottom: 1rem; right: 1rem; width: 20rem; background-color: white; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: none; }
        #chat-messages { height: 24rem; overflow-y: auto; padding: 1rem; }
        .message { padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.5rem; }
        .message.bot { background-color: #f3f4f6; }
        .message.user { background-color: #fef3c7; margin-left: auto; }
        .modal { display: none; position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); align-items: center; justify-content: center; }
        .modal-content { background-color: white; padding: 2rem; border-radius: 0.5rem; max-width: 28rem; width: 100%; }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-input { width: 100%; padding: 0.5rem; border: 1px solid #e5e5e5; border-radius: 0.375rem; }
        #menu-container { display: none; }
        .menu-tabs { display: flex; gap: 1rem; margin-bottom: 2rem; overflow-x: auto; padding-bottom: 1rem; }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="#" class="logo">PJ's BBQ</a>
            <div class="nav-links">
                <button onclick="showMenu()" class="btn btn-ghost">Menu</button>
                <button onclick="openReservationModal()" class="btn btn-primary">Reserve a Table</button>
            </div>
        </nav>
    </header>

    <main>
        <div id="home-container">
            <section class="hero" style="background-image: url('');">
                <div>
                    <h1>Flavors that Speak for Themselves</h1>
                    <p>Welcome to PJ's - Tampa's finest BBQ!</p>
                    <button onclick="showMenu()" class="btn btn-primary">View Menu</button>
                </div>
            </section>

            <section class="container">
                <div class="grid">
                    <img src="https://oaidalleapiprodscus.blob.core.windows.net/private/org-UT3ZcyAqBHL5qN78vx6OBNG8/user-7lJsSlgX3DXqHHmdl6CpJcBC/img-K5AntvcgKl7RZqOFCqSIHJRY.png?st=2025-01-21T19%3A06%3A42Z&se=2025-01-21T21%3A06%3A42Z&sp=r&sv=2024-08-04&sr=b&rscd=inline&rsct=image/png&skoid=d505667d-d6c1-4a0a-bac7-5c84a87759f8&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-01-21T18%3A37%3A07Z&ske=2025-01-22T18%3A37%3A07Z&sks=b&skv=2024-08-04&sig=G8%2BY5j%2BiF8ZW0eH7CDpA226YGpqULBtVWOsEEEk/ysg%3D" alt="Delicious BBQ - A variety of grilled meats and sauces" style="width: 100%; height: 16rem; object-fit: cover; border-radius: 0.5rem;">
                    <img src="https://oaidalleapiprodscus.blob.core.windows.net/private/org-UT3ZcyAqBHL5qN78vx6OBNG8/user-7lJsSlgX3DXqHHmdl6CpJcBC/img-DIfYxU4cNOG5qUiQHzDqqdRm.png?st=2025-01-21T19%3A06%3A51Z&se=2025-01-21T21%3A06%3A51Z&sp=r&sv=2024-08-04&sr=b&rscd=inline&rsct=image/png&skoid=d505667d-d6c1-4a0a-bac7-5c84a87759f8&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-01-21T05%3A16%3A07Z&ske=2025-01-22T05%3A16%3A07Z&sks=b&skv=2024-08-04&sig=6Vzfd4Bn0t%2Bjd9y7341opcWQcRzIF%2B4dyfXEF6yE7Ts%3D" alt="Sizzling Barbecue - Perfectly grilled steaks on a flame grill" style="width: 100%; height: 16rem; object-fit: cover; border-radius: 0.5rem;">
                    <img src="https://oaidalleapiprodscus.blob.core.windows.net/private/org-UT3ZcyAqBHL5qN78vx6OBNG8/user-7lJsSlgX3DXqHHmdl6CpJcBC/img-A2yGLWBCF92KMsvtcUS3A6II.png?st=2025-01-21T19%3A07%3A01Z&se=2025-01-21T21%3A07%3A01Z&sp=r&sv=2024-08-04&sr=b&rscd=inline&rsct=image/png&skoid=d505667d-d6c1-4a0a-bac7-5c84a87759f8&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-01-21T07%3A48%3A17Z&ske=2025-01-22T07%3A48%3A17Z&sks=b&skv=2024-08-04&sig=VghIo8J85LmuoPgH0/aNJe1D1DQTyno57EaVigzJdBw%3D" alt="Smoking Meat - Classic smoked BBQ ribs and wings" style="width: 100%; height: 16rem; object-fit: cover; border-radius: 0.5rem;">
                    <img src="https://oaidalleapiprodscus.blob.core.windows.net/private/org-UT3ZcyAqBHL5qN78vx6OBNG8/user-7lJsSlgX3DXqHHmdl6CpJcBC/img-RA9drV0yrp2FlxlLPNcIFk9y.png?st=2025-01-21T19%3A07%3A12Z&se=2025-01-21T21%3A07%3A12Z&sp=r&sv=2024-08-04&sr=b&rscd=inline&rsct=image/png&skoid=d505667d-d6c1-4a0a-bac7-5c84a87759f8&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-01-21T01%3A09%3A33Z&ske=2025-01-22T01%3A09%3A33Z&sks=b&skv=2024-08-04&sig=dN0WgkVdEfVyNgvMF%2BWWBCxEILz24ATWdYoPpJ2OHGM%3D" alt="Outdoor BBQ Cooking - Chefs preparing barbeque at an outdoor event" style="width: 100%; height: 16rem; object-fit: cover; border-radius: 0.5rem;">
                </div>
            </section>

            <section class="reviews">
                <div class="container">
                    <h2 style="text-align: center; font-size: 2.25rem; margin-bottom: 3rem;">What Our Customers Say</h2>
                    <div class="review-container" id="reviews-carousel"></div>
                </div>
            </section>
        </div>

        <div id="menu-container" class="container">
            <h1 style="text-align: center; font-size: 2.25rem; margin-bottom: 2rem;">Our Menu</h1>

            <div style="margin-bottom: 3rem;">
                <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">Popular Dishes Heat Map</h3>
                <div id="heat-map" class="grid"></div>
            </div>

            <div class="menu-tabs" id="category-tabs"></div>
            <div class="grid" id="menu-items"></div>
        </div>
    </main>

    <button onclick="toggleChat()" class="btn btn-primary" style="position: fixed; bottom: 1rem; right: 1rem; width: 3rem; height: 3rem; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </button>

    <div id="chat-widget">
        <div style="padding: 1rem; border-bottom: 1px solid #e5e5e5;">
            <h3 style="font-weight: bold;">Chat with us</h3>
        </div>
        <div id="chat-messages"></div>
        <form onsubmit="sendMessage(event)" style="padding: 1rem; border-top: 1px solid #e5e5e5;">
            <div style="display: flex; gap: 0.5rem;">
                <input type="text" id="chat-input" class="form-input" placeholder="Type your message...">
                <button type="submit" class="btn btn-primary" style="padding: 0.5rem;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </form>
    </div>

    <div id="reservation-modal" class="modal">
        <div class="modal-content">
            <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">Make a Reservation</h2>
            <form onsubmit="submitReservation(event)">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" name="name" required class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" required class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <input type="tel" name="phone" required class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Date & Time</label>
                    <input type="datetime-local" name="date" required class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Number of Guests</label>
                    <input type="number" name="guests" min="1" required class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Special Requests</label>
                    <textarea name="notes" class="form-input"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                    <button type="button" onclick="closeReservationModal()" class="btn btn-ghost">Cancel</button>
                    <button type="submit" class="btn btn-primary">Book Table</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global state
        let menuItems = [];
        let categories = [];
        let currentReview = 0;
        let reviews = [];

        // Fetch menu items
        async function fetchMenu() {
            const response = await fetch('/api/menu');
            menuItems = await response.json();
            categories = [...new Set(menuItems.map(item => item.category))];
            renderCategories();
            renderHeatMap();
            renderMenuItems(categories[0]);
        }

        // Initialize reviews carousel
        async function loadReviews() {
            const response = await fetch('/api/reviews');
            reviews = await response.json();
            renderReviews();
        }

        function renderReviews() {
            const container = document.getElementById('reviews-carousel');
            container.innerHTML = `
                <div class="review-cards" style="transform: translateX(-${currentReview * 100}%)">
                    ${reviews.map(review => `
                        <div style="flex: 0 0 100%; padding: 0 1rem;">
                            <div class="card">
                                <div class="card-content">
                                    <div style="display: flex; gap: 0.25rem; margin-bottom: 0.5rem;">
                                        ${'⭐'.repeat(review.rating)}
                                    </div>
                                    <p style="margin-bottom: 1rem;">${review.comment}</p>
                                    <p style="font-weight: 500;">${review.name}</p>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <button onclick="previousReview()" class="btn btn-ghost" style="position: absolute; left: 0; top: 50%; transform: translateY(-50%)">←</button>
                <button onclick="nextReview()" class="btn btn-ghost" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%)">→</button>
            `;
        }

        function nextReview() {
            currentReview = (currentReview + 1) % reviews.length;
            renderReviews();
        }

        function previousReview() {
            currentReview = (currentReview - 1 + reviews.length) % reviews.length;
            renderReviews();
        }

        function renderHeatMap() {
            const heatMap = document.getElementById('heat-map');
            const maxOrders = Math.max(...menuItems.map(item => item.orderCount));

            heatMap.innerHTML = menuItems.map(item => {
                const intensity = item.orderCount / maxOrders;
                const backgroundColor = `hsl(15, ${Math.round(intensity * 100)}%, 45%)`;
                const textColor = item.orderCount > maxOrders / 2 ? 'white' : 'inherit';

                return `
                    <div class="card" style="cursor: pointer; transform: scale(1); transition: transform 0.2s;"
                         onmouseover="this.style.transform='scale(1.05)'"
                         onmouseout="this.style.transform='scale(1)'">
                        <div class="card-content" style="background-color: ${backgroundColor}; color: ${textColor}">
                            <p style="font-weight: 500;">${item.name}</p>
                            <p style="font-size: 0.875rem; opacity: 0.9;">Ordered ${item.orderCount} times</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCategories() {
            const tabs = document.getElementById('category-tabs');
            tabs.innerHTML = categories.map(category => `
                <button
                    onclick="renderMenuItems('${category}')"
                    class="category-tab btn btn-ghost"
                    data-category="${category}">
                    ${category}
                </button>
            `).join('');

            document.querySelector('.category-tab').classList.add('btn-primary');
        }

        function renderMenuItems(category) {
            document.querySelectorAll('.category-tab').forEach(tab => {
                if (tab.dataset.category === category) {
                    tab.classList.add('btn-primary');
                    tab.classList.remove('btn-ghost');
                } else {
                    tab.classList.remove('btn-primary');
                    tab.classList.add('btn-ghost');
                }
            });

            const container = document.getElementById('menu-items');
            const items = menuItems.filter(item => item.category === category);

            container.innerHTML = items.map(item => `
                <div class="card" style="transform: scale(1); transition: transform 0.2s;"
                     onmouseover="this.style.transform='scale(1.05)'"
                     onmouseout="this.style.transform='scale(1)'">
                    ${item.imageUrl ? `
                        <img src="https://oaidalleapiprodscus.blob.core.windows.net/private/org-UT3ZcyAqBHL5qN78vx6OBNG8/user-7lJsSlgX3DXqHHmdl6CpJcBC/img-rARmt50pKFJgm7cnjgzxp5fU.png?st=2025-01-21T19%3A07%3A23Z&se=2025-01-21T21%3A07%3A23Z&sp=r&sv=2024-08-04&sr=b&rscd=inline&rsct=image/png&skoid=d505667d-d6c1-4a0a-bac7-5c84a87759f8&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-01-21T11%3A58%3A34Z&ske=2025-01-22T11%3A58%3A34Z&sks=b&skv=2024-08-04&sig=4PZcSLJiB1LLfqnMUBEnqL/9EysZXnraGNM8RHNGmUQ%3D" alt="${item.name}" style="width: 100%; height: 12rem; object-fit: cover;">
                    ` : ''}
                    <div class="card-content">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <h3 style="font-size: 1.25rem; font-weight: 500;">${item.name}</h3>
                            <button onclick="shareMenuItem(${item.id})" class="btn btn-ghost" style="padding: 0.25rem;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="18" cy="5" r="3"></circle>
                                    <circle cx="6" cy="12" r="3"></circle>
                                    <circle cx="18" cy="19" r="3"></circle>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                </svg>
                            </button>
                        </div>
                        <p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">${item.description}</p>
                        <p style="font-size: 1.25rem; font-weight: bold;">$${(item.price / 100).toFixed(2)}</p>
                    </div>
                </div>
            `).join('');
        }

        function showMenu() {
            document.getElementById('home-container').style.display = 'none';
            document.getElementById('menu-container').style.display = 'block';
        }

        function showHome() {
            document.getElementById('home-container').style.display = 'block';
            document.getElementById('menu-container').style.display = 'none';
        }

        function toggleChat() {
            const chatWidget = document.getElementById('chat-widget');
            chatWidget.style.display = chatWidget.style.display === 'none' ? 'block' : 'none';
            if (chatWidget.style.display === 'block') {
                document.getElementById('chat-input').focus();
            }
        }

        async function sendMessage(event) {
            event.preventDefault();
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            appendMessage(message, false);
            input.value = '';
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                if (!response.ok) throw new Error('Failed to send message');
                const data = await response.json();
                appendMessage(data.text, true);
            } catch (error) {
                appendMessage("I'm having trouble connecting right now. Please try again later!", true);
            }
        }

        function appendMessage(text, isBot) {
            const messages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isBot ? 'bot' : 'user'}`;
            messageDiv.textContent = text;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function openReservationModal() {
            document.getElementById('reservation-modal').style.display = 'flex';
        }

        function closeReservationModal() {
            document.getElementById('reservation-modal').style.display = 'none';
        }

        async function submitReservation(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            try {
                const response = await fetch('/api/reservations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error('Failed to make reservation');
                alert('Reservation confirmed! We\'ll see you soon!');
                closeReservationModal();
                event.target.reset();
            } catch (error) {
                alert('Failed to make reservation. Please try again.');
            }
        }

        async function shareMenuItem(id) {
            const item = menuItems.find(i => i.id === id);
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: item.name,
                        text: item.description,
                        url: window.location.href
                    });
                } catch (err) {
                    console.error('Error sharing:', err);
                }
            }
        }

        window.onload = function() {
            fetchMenu();
            loadReviews();
            showHome();
        };
    </script>
</body>
</html>
